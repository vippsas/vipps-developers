# Vipps Developer Portal: User Manual


_**IMPORTANT:**_ This guide is outdated. Please see the [Getting Started](vipps-getting-started.md) guide.

Document version: 0.1.1.

# About this Manual

This manual aims to give guidance in Vipps Developer Portal and describe features and functionalities available.

## Purpose

This manual presents the functional capabilities and operational details of the developer portal and explains the procedures for utilizing the features and functionalities available in the portal.

## Who should read this manual?

This manual is intended for those who will be using the Vipps Developer Portal to register and configure their applications that interact with Vipps APIs.

# Introduction

This manual describes features and operational details of Vipps Developer Portal and explains the procedures for utilizing the features and functionalities available in the portal.
Vipps developer portal serves as the main web presence for developers, where user can:
* Read API documentation.
* Try out an API via the interactive console.
* View analytics on their usage.

## What is available in the portal?

Vipps developer portal facilitates merchant developers to perform following things:
* Test the APIs via the interactive console
* Register an application to get API access
* View registered applications
* Remove a registered application
* View user profile information
* View analytics and usage reports

All the above features and functionalities are described in detail on the later sections.

# Signing in

See the
[Getting Started](vipps-developer-portal-getting-started.md)
guide for a quick intro.

Please note the difference between the Test and Production environments,
both in appearance and login credentials:

## Test environment: Purple

The test environment has a purple header:

![Vipps Developer Portal: Test](images/devportal-test-home.png)

* Vipps Developer Portal URL: https://apitest-portal.vipps.no/
* A username that looks like this: username@**testapivipps**.no
* A default password.

## Production environment: Orange

The test environment has an orange header:

![Vipps Developer Portal: Production](images/devportal-prod-home.png)

* Vipps Developer Portal URL: https://api-portal.vipps.no/
* A username that looks like this: username@**apivipps**.no`
* A default password.

For password changes in either test or production, please [contact us](contact.md).

# Features and Functionalities

The following sections describe the various functionalities a merchant developer should learn before they can successfully interact with Vipps APIs.

## User Profile

Under the profile tab (the account name at the top right, "FIRSTNAME LASTNAME" in this example),
you will find the profile and subscription details:

![Profile](images/devportal-test-profile.png)

### Profile

Profile contains the information of user signed in. Basic information like Email, first name and last name of the user will be displayed here.

### Subscriptions

This contains all the subscribed products details which include Subscription name, primary key, secondary key(these are subscription key), product name and state of that product. The primary and secondary keys will be hidden by default. The key can be seen by clicking on show button corresponding to the product and key. The keys can be regenerated by clicking regenerate link corresponding to each link.

_*Note:* The goal of the primary and secondary keys is to allow for "rolling" upgrades.
This allows for regenerating the one key, while still allowing clients to use the other key._

# Products

The products listed depend on the merchant's commercial agreement.
The “Access Token” product is available for all merchants by default.

![Products](images/devportal-test-products.png)

Several APIs may be available.
In this example we will use `eCommerce-Express-Checkout-Signup-Login-Services`:

![Test the API(s)](images/devportal-test-products-ecommerce.png)

Click on the **"TEST THE API(S)"** button (in this example: `GetOrderStatus_v2`):

![Test: Get Order Status](images/devportal-test-getorderstatus-0.png)

Add the the proper keys to initiate your request. See
[Vipps Developer Portal: Getting Started](vipps-developer-portal-getting-started.md)
for how to obtain the API keys.

![Test: Get Order Status](images/devportal-test-getorderstatus-1.png)

![Test: Get Order Status](images/devportal-test-getorderstatus-2.png)

## Product Details

Each Product represents a set of API operations application can invoke to consume a backend
resource. Each API operation contains a reference to the back-end service that implements the
API and its operations map to the methods implemented by the back-end service.

User can see all the API services of each product and test the same by clicking on the “TEST THE API(S)” button.

You may have several APIs available.
In this example we will use `eCommerce-Express-Checkout-Signup-Login-Services`,
and this page is shown after you click the product name:

![Test the API(s)](images/devportal-test-products-ecommerce.png)

Click on the **"Try it"** button:
![Try it](images/devportal-test-getorderstatus-tryit.png)

Click on the **"TEST THE API(S)"** button (in this example: `GetOrderStatus_v2`):

![Test: Access Token](images/devportal-test-getorderstatus-0.png)

Add the the proper keys to initiate your request:

![Test: Access Token](images/devportal-test-getorderstatus-1.png)

![Test: Access Token](images/devportal-test-getorderstatus-2.png)

* List of operations in the API with HTTP verb type like GET, POST etc.
* Description of the API and it’s all Operations.
* Request and Response format.
* Code samples in various languages for how to invoke an operation.
* The API definition can be downloaded by clicking on the "API Definition" button.

*TODO: Image*

*TODO: Image*

*TODO: Image*

API definition enables API developers to export API definitions in Swagger and WADL formats
from the developer portal. API developers can use these files to generate client-side code by
using tools such as Swagger Codegen. They can also import these files into API client tools
such as Postman and start calling the API in very little time.

*TODO: Image*

## Register an Application

This is no longer used.

Under the tab **"REGISTER APPLICATION"** it should say, marked in red: 'All existing products have been subscribed':

![registerapplication](images/devportal-test-registerapplication.png)


### Regenerate Client secret

User can regenerate client secret if he forgets the secret or if the client secret has been expired, user can regenerate it to use it again. The expiry time for client secret is one year.
1. Click the Regenerate Secret button against the application for which secret needs to be regenerated.
2. Regenerated secret along with client id will be displayed on the page as shown in the picture.

*TODO: Image*

### Remove a Registered Application
If the merchant does not want to maintain an application, or if he does not want to use any API for a particular application, he can remove a registered application from portal.

1. Click on the Applications tab in navigation bar to navigate to the registered applications page.
2. Click on Delete link against the application that needs to be removed.
3. An alert message will be displayed as ‘Are you sure you want to delete this item?’
4. Click on OK to remove the application.

*TODO: Image*

## How to Test the APIs

All APIs required to be tested before use. To test an API we need access token in authorization header of the request. Merchant should register at least one application to get the client id and secret that is required for getting the access token. Using Postman or from developer portal, this access token can be acquired.

### Get an Access Token

Access token is available in a REST endpoint url. So any REST client tool or application can easily connect to token endpoint to get the access token. Following are some way described how to get an access token
Using developer portal:

1. Click on Product tab in navigation bar to see all the Products.
2. Click on Access Token Product to navigate to access token product page.
3. Click on “TRYIT” button.
4. Enter the client Id, client secret and APIM Subscription key (Subscription key will be automatically filled) in the header and click Send button.
5. As a response access token will be received.

*TODO: Image*

*TODO: Image*

## Using Application Code:

The merchants can get an access token using a custom application in any language. Given below are the examples of custom application written in java and C# to get an access token.

### Sample code in Java:

*TODO: LINK TO - AND EMBED! -WORKING EXAMPLE CODE.*

```Java
// This sample uses the Apache HTTP client from HTTP Components (http://hc.apache.org/httpcomponents-client- ga/)//
import java.net.URI;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.utils.URIBuilder;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;

public class JavaSample
{
public static void main(String[] args)
{
HttpClient httpclient = HttpClients.createDefault();
try
{
URIBuilder builder = new URIBuilder("https://portal.apivipps.no/accessToken/get"); URI uri = builder.build();
HttpPost request = new HttpPost(uri); request.setHeader("Ocp-Apim-Subscription-Key", "{subscription key}"); request.setHeader("client_id", "{client_id}");
request.setHeader("client_secret", "{client_secret}");
// Request body
StringEntity reqEntity = new StringEntity("{body}");
request.setEntity(reqEntity);
HttpResponse response = httpclient.execute(request); HttpEntity entity = response.getEntity();
if (entity != null)
{
System.out.println(EntityUtils.toString(entity));
} }
catch (Exception e)
{
System.out.println(e.getMessage());
} }
}
```

### Sample code in C#

*TODO: LINK TO - AND EMBED! -WORKING EXAMPLE CODE.*

```
using System;
using System.Net.Http.Headers; using System.Text;
using System.Net.Http;
using System.Web;
namespace CSHttpClientSample
{
static class Program
{
static void Main()
{
MakeRequest();
Console.WriteLine("Hit ENTER to exit..."); Console.ReadLine();
}
static async void MakeRequest()
{
var client = new HttpClient();
var queryString = HttpUtility.ParseQueryString(string.Empty);
// Request headers
client.DefaultRequestHeaders.Add("Ocp-Apim-Subscription-Key", "{subscription key}");
client.DefaultRequestHeaders.Add("client_id", "{client_id}"); client.DefaultRequestHeaders.Add("client_secret", "{client_secret}");
var uri = " https://portal.apivipps.no/accessToken/get?" + queryString;
// Request body
byte[] byteData = Encoding.UTF8.GetBytes("{body}");
using (var content = new ByteArrayContent(byteData))
{
content.Headers.ContentType = new MediaTypeHeaderValue("< your content type, i.e. application/json
>");
}
} }
}
```

_Note: The access token lifetime is 1 day (24 hours). It can be reused till 24 hours rather than requesting it every time before an API call._

### Using Postman

*TODO: Fix c&p text, update with links, mention client, etc*

1. OpenthepostmanfromAppslinkinGooglechrome.
Enterthetokenendpointurl(i.e.https://apitest.vipps.no/accessToken/get)inpostman address bar.
2. Addclient_id,client_secretandOcp-Apim-Subscription-Keyinrequestbodyaskey- value pair. The client_id, client_secret value should be the one received while registering an application. Subscription Key(Ocp-Apim-Subscription-Key) is available in user profile page.
3. Changethehttpverbto‘POST’andhitSendbutton.Accesstokenwillbereceivedin response as shown below.

*TODO: Image*

After getting access token by any of the above methods please continue with the below steps to test an API.

1. Click on the Product tab in navigation bar to navigate to a Product page and click on “TEST THE API(S)” button to see all the APIs of each and every product.
2. Select the API to be tested and click on “Try It” button to test it.
3. Enter the access token in authorization header, subscription key which merchants will get in their profile page for that product and other request parameters as per the API documentation.
4. Finallyclickon“Send”button.

*TODO: Image*

*TODO: Image*

*TODO: Image*

## Reports & Analytics
The Analytics Reports section provides a detailed metrics and analytics report on various information like usage and health of APIs and operations, activities performed by developer, products etc. It has the following four tabs:

* At a glance: Provides overall usage and health metrics
* Usage: Provides an in-depth look at API calls and bandwidth
* Health: Provides data for usage over time for cache, response time and status codes
* Activity: Provides statistics for success rates for API calls and average response time

# How to call Vipps APIs from application

As described in earlier sections, any application must pass the APIM subscription key and access token in request header to call a Vipps API. The access token has an expiry time of max. 1 day (24 hours).

The following pseudo code samples would help a developer how to get an access token and use it to call an API from a custom application. It also shows the way of regenerating the access token and uses it for API calls once previous token is expired.

## Define an Application Cache

To reuse access token we need to temporarily store it somewhere, application can easily get it. It is better to store the token in application cache like InMemory or Redis Cache service for faster access.

### Cache pseudo code

*TODO: c&p code*

## Get Access Token

*TODO: Duplicate? Replaceble with reference/link?*

Following code sample shows how to get an access token and save it in cache to reuse until it expires. To get the access token we need to call the “https://apitest.vipps.no/accessToken/get” endpoint, given in the developer portal. The “isNew” argument decides whether a new token will be generated or it will be fetched from cache. Access token endpoint url requires following parameters in the request.

* SubscriptionKey – This will be found in developer portal
* ClientId and ClientSecret – You will get these values when you register an application as stated in section 3.3 : Register an Application

### GetAccessToken pseudo code

*TODO: LINK TO - AND EMBED! -WORKING EXAMPLE CODE.*

```
var token = string.Empty();
var client = new HttpClient();
var queryString = HttpUtility.ParseQueryString(string.Empty);
var cache = new Cache();
public async string GetAccessToken(bool isNew)
  {
    If(isNew)
    var cacheClient = new CacheClient(“cache connection details”); public string GetAccessToken(string key)
      {
      // Request headers
      client.DefaultRequestHeaders.Add("Ocp-Apim-Subscription-Key", "{subscription key}"); client.DefaultRequestHeaders.Add("client_id", "{client_id}"); client.DefaultRequestHeaders.Add("client_secret", "{client_secret}");
      var uri = " https://portal.apivipps.no/accessToken/get?" + queryString; // Request body if any
      byte[] byteData = Encoding.UTF8.GetBytes("{body}");
      using (var content = new ByteArrayContent(byteData))
      {
      content.Headers.ContentType = new MediaTypeHeaderValue("application/json"); var response = await client.PostAsync(uri, content);
      var responseContent = await response.Content.ReadAsStringAsync();
      //Get access token from responseContent token = responseContent.{AccessToken}
      // Save token in cache [Optional]
      cache. SaveAccessToken(“AccessToken”, token);
  }
  return token; Else
} { }

```

## Call an API

*TODO: Update, refer, split up, IMPROVE this section*

Once you get an access token, now you can call an API. Before calling an API from an application you can test it developer portal as stated in section

## How to Test the APIs. Follow this code sample below for how to call a Vipps API.

### API calls pseudo code

*TODO: Replace with HTTP examples, make sections/paragraphs, use Java "pesudo" code in addition, but in smaller chunks*
